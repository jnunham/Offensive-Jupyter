import re
import pandas as pd

# Paste your raw input text here
text = """
<PASTE YOUR INPUT TEXT HERE>
"""

# Split the text into blocks for each "unsupported installation"
blocks = re.split(r"The following unsupported installation of Microsoft SQL Server was\s+detected :", text)
records = []

for block in blocks:
    # Skip empty or irrelevant parts
    if not block.strip():
        continue

    # Extract SQL instance
    instance_match = re.search(r"SQL Server Instance\s*:\s*(\S+)", block)
    instance = instance_match.group(1) if instance_match else None

    # Extract version
    version_match = re.search(r"Installed version\s*:\s*([\d\.]+)", block)
    version = version_match.group(1) if version_match else None

    # Extract IP addresses
    ips = re.findall(r"\b\d{1,3}(?:\.\d{1,3}){3}\b", block)

    # Add records for each IP
    for ip in ips:
        records.append({
            "IP Address": ip,
            "SQL Instance": instance,
            "SQL Version": version
        })

# Create DataFrame
df = pd.DataFrame(records)

# Deduplicate rows
df = df.drop_duplicates().sort_values(by=["SQL Instance", "IP Address"])

# Save to CSV
output_file = "sql_instances.csv"
df.to_csv(output_file, index=False)

print(f"âœ… Extracted {len(df)} unique entries. Saved to {output_file}.")
df
